(function(){var j=Box2D.Common.Math.b2Vec2,b=Box2D.Collision.b2AABB,c=Box2D.Dynamics.b2BodyDef,i=Box2D.Dynamics.b2Body,d=Box2D.Dynamics.b2FixtureDef,f=Box2D.Dynamics.b2Fixture,l=Box2D.Dynamics.b2World,m=Box2D.Collision.Shapes.b2MassData,e=Box2D.Collision.Shapes.b2PolygonShape,k=Box2D.Collision.Shapes.b2CircleShape,h=Box2D.Dynamics.b2DebugDraw,a=Box2D.Dynamics.Joints.b2RevoluteJointDef,g=Box2D.Dynamics.Joints.b2MouseJointDef;
collie.Box2d=collie.Class({ITERATIONS_VELOCITY:6,ITERATIONS_POSITION:3,WIDTH_OF_WALL:10,$init:function(o,n,p){this._oDebugLayer=null;
this._oDebugDraw=null;this._bIsLoaded=false;this._bIsDebug=false;this._nStep=60;this._nWidth=0;this._nHeight=0;this._htFixtures={};
this._htBodies={};p=p||10;this._htWall={};this._oWorld=this.createWorld(p);this._fOnProcess=this._onProcess.bind(this);this.resize(o,n)
},getBody:function(o){var n=o.getId();return this._htBodies[n]||false},addFixture:function(p,o,q){if(q){o.shape=q}var n=this.createFixture(o);
this._htFixtures[p]=n},removeFixture:function(n){delete this._htFixtures[n]},getFixture:function(p){if(this._htFixtures[p]){var o=new d();
for(var n in this._htFixtures[p]){o[n]=this._htFixtures[p][n]}return o}else{return false}},createFixture:function(o){var n=new d();
n.density=typeof o.density!="undefined"?o.density:n.density;n.filter=o.filter||n.filter;n.friction=typeof o.friction!="undefined"?o.friction:n.friction;
n.restitution=typeof o.restitution!="undefined"?o.restitution:n.restitution;n.isSensor=o.isSensor||n.isSensor;n.userData=o.userData||n.userData;
n.shape=o.shape||n.shape;return n},createBody:function(o){var n=new c();n.active=o.active||n.active;n.allowSleep=o.allowSleep||n.allowSleep;
n.angle=o.angle||n.angle;n.angularDamping=o.angularDamping||n.angularDamping;n.angularVelocity=o.angularVelocity||n.angularVelocity;
n.awake=o.awake||n.awake;n.bullet=o.bullet||n.bullet;n.fixedRotation=o.fixedRotation||n.fixedRotation;n.inertiaScale=o.inertiaScale||n.inertiaScale;
n.linearDamping=o.linearDamping||n.linearDamping;n.linearVelocity=o.linearVelocity||n.linearVelocity;n.position.x=o.x/collie.Box2d.SCALE||0;
n.position.y=o.y/collie.Box2d.SCALE||0;switch(o.type){case"static":n.type=i.b2_staticBody;break;case"kinematic":n.type=i.b2_kinematicBody;
break;case"dynamic":default:n.type=i.b2_dynamicBody}n.userData=o.userData||n.userData;return n},createObject:function(s,t,q){var r=s.get();
t.userData=s.getId();t.x=r.x+r.width/2;t.y=r.y+r.height/2;var o=this.createBody(t);var p=typeof q=="string"?this.getFixture(q):q;
if("groupIndex" in t){p.filter.groupIndex=t.groupIndex}if(!p.shape){p.shape=this._createShape(s,t)}var n=this._oWorld.CreateBody(o);
this._htBodies[t.userData]=n;n.CreateFixture(p);return n},createStaticObject:function(r,q){var p;r.type="static";r.x+=r.width/2;
r.y+=r.height/2;if(!q){p=new d()}else{p=typeof q=="string"?this.getFixture(q):q}if(!p.shape){p.shape=this._createShape(null,r)
}var o=this.createBody(r);var n=this._oWorld.CreateBody(o);n.CreateFixture(p);return n},createWall:function(o,p){var n;switch(o){case"left":n=this.createStaticObject({x:-this.WIDTH_OF_WALL,y:-this.WIDTH_OF_WALL,width:this.WIDTH_OF_WALL,height:this._nHeight+this.WIDTH_OF_WALL*2},p);
break;case"right":n=this.createStaticObject({x:this._nWidth,y:-this.WIDTH_OF_WALL,width:this.WIDTH_OF_WALL,height:this._nHeight+this.WIDTH_OF_WALL*2},p);
break;case"top":n=this.createStaticObject({x:-this.WIDTH_OF_WALL,y:-this.WIDTH_OF_WALL,width:this._nWidth+this.WIDTH_OF_WALL*2,height:this.WIDTH_OF_WALL},p);
break;case"bottom":n=this.createStaticObject({x:-this.WIDTH_OF_WALL,y:this._nHeight,width:this._nWidth+this.WIDTH_OF_WALL*2,height:this.WIDTH_OF_WALL},p);
break;default:throw new Error("not invalid direction")}this._htWall[o]=n;return n},removeObject:function(n){if(collie.Box2d.hasUserData(n)){delete this._htBodies[n.GetUserData()]
}this._oBody.DestroyBody(n)},_createShape:function(o,p){var n;if(("width" in p)&&("height" in p)){n=this._createShapeBox(p.width/collie.Box2d.SCALE,p.height/collie.Box2d.SCALE)
}else{if(("radius" in p)){n=this._createShapeCircle(p.radius/collie.Box2d.SCALE)}else{if(o){if(o instanceof collie.Circle){n=this._createShapeCircle(o.get("radius")/collie.Box2d.SCALE)
}else{n=this._createShapeBox(o.get("width")/collie.Box2d.SCALE,o.get("height")/collie.Box2d.SCALE)}}}}return n},_createShapeBox:function(p,n){var o=new e();
o.SetAsBox(p/2,n/2);return o},_createShapeCircle:function(n){return new k(n)},createContact:function(q,o,r,n){var p=new Box2D.Dynamics.b2ContactListener();
if(typeof q!="undefined"){p.BeginContact=q}if(typeof o!="undefined"){p.EndContact=o}if(typeof r!="undefined"){p.PostSolve=r
}if(typeof n!="undefined"){p.PreSolve=n}this._oWorld.SetContactListener(p)},createRevoluteJoint:function(r,q,p,o){var n=new a();
o=o||{};n.initialize(r,q,p);n.enableLimit=typeof o.enableLimit!="undefined"?o.enableLimit:n.enableLimit;n.enableMotor=typeof o.enableMotor!="undefined"?o.enableMotor:n.enableMotor;
n.localAnchorA=typeof o.localAnchorA!="undefined"?o.localAnchorA:n.localAnchorA;n.localAnchorB=typeof o.localAnchorB!="undefined"?o.localAnchorB:n.localAnchorB;
n.lowerAngle=typeof o.lowerAngle!="undefined"?o.lowerAngle:n.lowerAngle;n.maxMotorTorque=typeof o.maxMotorTorque!="undefined"?o.maxMotorTorque:n.maxMotorTorque;
n.motorSpeed=typeof o.motorSpeed!="undefined"?o.motorSpeed:n.motorSpeed;n.referenceAngle=typeof o.referenceAngle!="undefined"?o.referenceAngle:n.referenceAngle;
n.upperAngle=typeof o.upperAngle!="undefined"?o.upperAngle:n.upperAngle;return this._oWorld.CreateJoint(n)},createDistanceJoint:function(s,r,q,o,p){var n=new Box2D.Dynamics.Joints.b2DistanceJointDef();
p=p||{};n.initialize(s,r,q,o);n.dampingRatio=typeof p.dampingRatio!="undefined"?p.dampingRatio:n.dampingRatio;n.frequencyHz=typeof p.frequencyHz!="undefined"?p.frequencyHz:n.frequencyHz;
n.length=typeof p.length!="undefined"?p.length:n.length;n.localAnchorA=typeof p.localAnchorA!="undefined"?p.localAnchorA:n.localAnchorA;
n.localAnchorB=typeof p.localAnchorB!="undefined"?p.localAnchorB:n.localAnchorB;return this._oWorld.CreateJoint(n)},createFrictionJoint:function(r,q,p,o){var n=new Box2D.Dynamics.Joints.b2FrictionJointDef();
o=o||{};n.initialize(r,q,p);n.localAnchorA=typeof o.localAnchorA!="undefined"?o.localAnchorA:n.localAnchorA;n.localAnchorB=typeof o.localAnchorB!="undefined"?o.localAnchorB:n.localAnchorB;
n.maxForce=typeof o.maxForce!="undefined"?o.maxForce:n.maxForce;n.maxTorque=typeof o.maxTorque!="undefined"?o.maxTorque:n.maxTorque;
return this._oWorld.CreateJoint(n)},createGearJoint:function(p,o,n){var q=new Box2D.Dynamics.Joints.b2GearJointDef();q.joint1=o;
q.joint2=o;q.ratio=n;return this._oWorld.CreateJoint(q)},createLineJoint:function(s,r,p,q,o){var n=new Box2D.Dynamics.Joints.b2LineJointDef();
o=o||{};n.initialize(s,r,p,q);n.enableLimit=typeof o.enableLimit!="undefined"?o.enableLimit:n.enableLimit;n.enableMotor=typeof o.enableMotor!="undefined"?o.enableMotor:n.enableMotor;
n.localAnchorA=typeof o.localAnchorA!="undefined"?o.localAnchorA:n.localAnchorA;n.localAnchorB=typeof o.localAnchorB!="undefined"?o.localAnchorB:n.localAnchorB;
n.localAxisA=typeof o.localAxisA!="undefined"?o.localAxisA:n.localAxisA;n.lowerTranslation=typeof o.lowerTranslation!="undefined"?o.lowerTranslation:n.lowerTranslation;
n.maxMotorForce=typeof o.maxMotorForce!="undefined"?o.maxMotorForce:n.maxMotorForce;n.motorSpeed=typeof o.motorSpeed!="undefined"?o.motorSpeed:n.motorSpeed;
n.upperTranslation=typeof o.upperTranslation!="undefined"?o.upperTranslation:n.upperTranslation;return this._oWorld.CreateJoint(n)
},createMouseJoint:function(o,n,q){var p=new Box2D.Dynamics.Joints.b2MouseJointDef();q=q||{};p.bodyA=this._oWorld.GetGroundBody();
p.bodyB=o;p.target=n;p.dampingRatio=typeof q.dampingRatio!="undefined"?q.dampingRatio:p.dampingRatio;p.frequencyHz=typeof q.frequencyHz!="undefined"?q.frequencyHz:p.frequencyHz;
p.maxForce=typeof q.maxForce!="undefined"?q.maxForce:p.maxForce;return this._oWorld.CreateJoint(p)},createPrismaticJoint:function(s,r,p,q,o){var n=new Box2D.Dynamics.Joints.b2PrismaticJointDef();
o=o||{};n.initialize(s,r,p,q);n.enableLimit=typeof o.enableLimit!="undefined"?o.enableLimit:n.enableLimit;n.enableMotor=typeof o.enableMotor!="undefined"?o.enableMotor:n.enableMotor;
n.localAnchorA=typeof o.localAnchorA!="undefined"?o.localAnchorA:n.localAnchorA;n.localAnchorB=typeof o.localAnchorB!="undefined"?o.localAnchorB:n.localAnchorB;
n.localAxisA=typeof o.localAxisA!="undefined"?o.localAxisA:n.localAxisA;n.lowerTranslation=typeof o.lowerTranslation!="undefined"?o.lowerTranslation:n.lowerTranslation;
n.maxMotorForce=typeof o.maxMotorForce!="undefined"?o.maxMotorForce:n.maxMotorForce;n.motorSpeed=typeof o.motorSpeed!="undefined"?o.motorSpeed:n.motorSpeed;
n.referenceAngle=typeof o.referenceAngle!="undefined"?o.referenceAngle:n.referenceAngle;n.upperTranslation=typeof o.upperTranslation!="undefined"?o.upperTranslation:n.upperTranslation;
return this._oWorld.CreateJoint(n)},createPulleyJoint:function(s,r,u,t,q,p,o,v){var n=new Box2D.Dynamics.Joints.b2PulleyJointDef();
v=v||{};n.initialize(s,r,u,t,q,p,o);n.lengthA=typeof v.lengthA!="undefined"?v.lengthA:n.lengthA;n.lengthB=typeof v.lengthB!="undefined"?v.lengthB:n.lengthB;
n.localAnchorA=typeof v.localAnchorA!="undefined"?v.localAnchorA:n.localAnchorA;n.localAnchorB=typeof v.localAnchorB!="undefined"?v.localAnchorB:n.localAnchorB;
n.maxLengthA=typeof v.maxLengthA!="undefined"?v.maxLengthA:n.maxLengthA;n.maxLengthB=typeof v.maxLengthB!="undefined"?v.maxLengthB:n.maxLengthB;
return this._oWorld.CreateJoint(n)},createWeldJoint:function(r,q,p,o){var n=new Box2D.Dynamics.Joints.b2WeldJointDef();o=o||{};
n.initialize(r,q,p);n.localAnchorA=typeof o.localAnchorA!="undefined"?o.localAnchorA:n.localAnchorA;n.localAnchorB=typeof o.localAnchorB!="undefined"?o.localAnchorB:n.localAnchorB;
n.referenceAngle=typeof o.referenceAngle!="undefined"?o.referenceAngle:n.referenceAngle;return this._oWorld.CreateJoint(n)
},removeJoint:function(n){this._oWorld.DestroyJoint(n)},createWorld:function(n){return new l(new j(0,n),true)},load:function(n){if(!this._bIsLoaded){this._bIsLoaded=true;
this._nStep=Math.round(1000/collie.Renderer.getDuration());if(n){this._setDebug(this._nWidth,this._nHeight)}collie.Renderer.attach("process",this._fOnProcess)
}},unload:function(){if(this._bIsLoaded){this._bIsLoaded=false;collie.Renderer.detach("process",this._fOnProcess);this._unsetDebug()
}},resize:function(q,p){var o,t,s,n;this._nWidth=q;this._nHeight=p;if(this._htWall){for(var r in this._htWall){switch(r){case"left":o=-this.WIDTH_OF_WALL+(this.WIDTH_OF_WALL/2);
t=-this.WIDTH_OF_WALL+((this._nHeight+this.WIDTH_OF_WALL*2)/2);s=this.WIDTH_OF_WALL;n=this._nHeight+this.WIDTH_OF_WALL*2;
break;case"right":o=this._nWidth+(this.WIDTH_OF_WALL/2);t=-this.WIDTH_OF_WALL+((this._nHeight+this.WIDTH_OF_WALL*2)/2);s=this.WIDTH_OF_WALL;
n=this._nHeight+this.WIDTH_OF_WALL*2;break;case"top":o=-this.WIDTH_OF_WALL+((this._nWidth+this.WIDTH_OF_WALL*2)/2);t=-this.WIDTH_OF_WALL+(this.WIDTH_OF_WALL/2);
s=this._nWidth+this.WIDTH_OF_WALL*2;n=this.WIDTH_OF_WALL;break;case"bottom":o=-this.WIDTH_OF_WALL+((this._nWidth+this.WIDTH_OF_WALL*2)/2);
t=this._nHeight+(this.WIDTH_OF_WALL/2);s=this._nWidth+this.WIDTH_OF_WALL*2;n=this.WIDTH_OF_WALL;break}o/=collie.Box2d.SCALE;
t/=collie.Box2d.SCALE;s/=collie.Box2d.SCALE;n/=collie.Box2d.SCALE;this._htWall[r].SetPosition(collie.Box2d.vec2(o,t));this._htWall[r].GetFixtureList().GetShape().SetAsBox(s/2,n/2)
}}},_setDebug:function(o,n){if(!this._bIsDebug){if(this._oDebugLayer===null){this._oDebugLayer=new collie.Layer({width:o,height:n})
}else{this._oDebugLayer.resize(o,n)}collie.Renderer.addLayer(this._oDebugLayer);if(this._oDebugDraw===null){this._oDebugDraw=new h();
this._oDebugDraw.SetSprite(this._oDebugLayer.getContext());this._oDebugDraw.SetDrawScale(30);this._oDebugDraw.SetFillAlpha(0.3);
this._oDebugDraw.SetLineThickness(1);this._oDebugDraw.SetFlags(h.e_shapeBit|h.e_jointBit);this._oWorld.SetDebugDraw(this._oDebugDraw)
}this._bIsDebug=true}},_unsetDebug:function(){if(this._bIsDebug){collie.Renderer.removeLayer(this._oDebugLayer);this._bIsDebug=false
}},_onProcess:function(p){var o=1/this._nStep;this._oWorld.Step(o,this.ITERATIONS_VELOCITY,this.ITERATIONS_POSITION);this._oWorld.ClearForces();
var n=this._oWorld.GetBodyList();if(n){do{if(n.IsActive()&&collie.Box2d.hasUserData(n)){this._update(n)}n=n.GetNext()}while(n)
}if(this._bIsDebug){this._oWorld.DrawDebugData()}},_update:function(n){var p=collie.util.getDisplayObjectById(n.GetUserData());
if(p){var o=p.get();var q=n.GetPosition();p.set("angle",collie.util.toDeg(n.GetAngle()));p.set("x",(q.x-((o.width/collie.Box2d.SCALE)/2))*collie.Box2d.SCALE);
p.set("y",(q.y-((o.height/collie.Box2d.SCALE)/2))*collie.Box2d.SCALE)}else{this._oWorld.DestroyBody(n)}}});collie.Box2d.vec2=function(o,p,n){if(n){o/=collie.Box2d.SCALE;
p/=collie.Box2d.SCALE}return new j(o,p)};collie.Box2d.hasUserData=function(o){var n=o.GetUserData();return(typeof n!="undefined")&&n!==null
};collie.Box2d.SCALE=30;collie.Box2d.BODY_TYPE={STATIC:"static",KINEMATIC:"kinematic",DYNAMIC:"dynamic"}})();